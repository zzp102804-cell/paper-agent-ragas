<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>Agent Stream Frontend</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f8f8f8;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        textarea, input {
            width: 100%;
            padding: 12px;
            font-size: 16px;
            border-radius: 6px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        #output {
            margin-top: 20px;
            background: #000;
            color: #0f0;
            padding: 15px;
            height: 350px;
            overflow-y: auto;
            font-family: Consolas, monospace;
            white-space: pre-wrap;
            border-radius: 6px;
        }
        button {
            padding: 12px 20px;
            font-size: 16px;
            margin-top: 10px;
            cursor: pointer;
            background: #0078ff;
            color: #fff;
            border: none;
            border-radius: 6px;
        }
        button:hover {
            background: #005fcc;
        }
    </style>
</head>
<body>
<div class="container">
    <h2>ğŸ’¡ å‘˜å·¥ç»©æ•ˆæ™ºèƒ½åŠ©æ‰‹ ğŸ’¡</h2>

    <label>è¾“å…¥ä½ çš„é—®é¢˜:</label>
    <textarea id="query" rows="4"
              placeholder="ä¾‹å¦‚ï¼šæŸ¥è¯¢äº§å“éƒ¨é—¨æ•´ä½“çš„å‘˜å·¥ç»©æ•ˆï¼Œå¹¶æ ¹æ®æ•°æ®æ€»ç»“åˆ†æ..."></textarea>

    <button onclick="sendRequest()">å¼€å§‹æ‰§è¡Œ</button>

    <h3>ğŸ“œ å®æ—¶è¾“å‡ºï¼š</h3>
    <div id="output"></div>
</div>

<script>
    async function sendRequest() {
        const query = document.getElementById("query").value.trim();
        const output = document.getElementById("output");
        output.textContent = "";

        if (!query) {
            output.textContent = "â— è¯·è¾“å…¥ Query";
            return;
        }

        const url = "http://127.0.0.1:8000/query";

        try {
            const response = await fetch("http://127.0.0.1:8000/query", {
				method: "POST",
				headers: {
					"Content-Type": "application/json"
				},
				body: JSON.stringify({ query })
        })

            // å¤„ç†æµå¼å“åº”
            const reader = response.body.getReader();
            const decoder = new TextDecoder("utf-8");

            while (true) {
                const { done, value } = await reader.read();
                if (done) break;

                const text = decoder.decode(value);
                output.textContent += text;

                // è‡ªåŠ¨æ»šåŠ¨åˆ°æœ€æ–°
                output.scrollTop = output.scrollHeight;
            }

        } catch (err) {
            output.textContent += "\nâŒ è¯·æ±‚å¤±è´¥ï¼šè¯·ç¡®è®¤åç«¯å·²å¯åŠ¨å¹¶å…è®¸ CORS\n";
            console.error(err);
        }
    }
</script>
</body>
</html>
